#!/bin/bash
# postrm script for maxiofs
# This script runs after the package is removed

set -e

case "$1" in
    purge)
        # Remove data directory and logs on purge
        echo "Purging MaxIOFS data and logs..."
        rm -rf /var/lib/maxiofs
        rm -rf /var/log/maxiofs
        rm -rf /etc/maxiofs

        # Remove user and group
        if getent passwd maxiofs > /dev/null 2>&1; then
            echo "Removing maxiofs system user..."
            deluser --quiet maxiofs > /dev/null || true
        fi

        echo "MaxIOFS has been completely removed."
        echo "WARNING: All data and encryption keys have been deleted."
        ;;

    remove)
        # On remove (not purge), keep all data and configuration
        if [ -d /run/systemd/system ]; then
            systemctl daemon-reload >/dev/null || true
        fi

        echo ""
        echo "========================================"
        echo "MaxIOFS has been removed."
        echo "========================================"
        echo ""
        echo "IMPORTANT: Your data has been preserved:"
        echo "  - Configuration: /etc/maxiofs/config.yaml (includes encryption key)"
        echo "  - Data directory: /var/lib/maxiofs"
        echo "  - Logs: /var/log/maxiofs"
        echo ""
        echo "You can reinstall MaxIOFS and your data will be accessible."
        echo ""
        echo "To completely remove all data including encryption keys:"
        echo "  sudo apt-get purge maxiofs"
        echo ""
        echo "WARNING: Purging will make your encrypted data permanently inaccessible!"
        echo ""
        ;;

    upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
        ;;

    *)
        echo "postrm called with unknown argument \`$1'" >&2
        exit 1
        ;;
esac

#DEBHELPER#

exit 0
